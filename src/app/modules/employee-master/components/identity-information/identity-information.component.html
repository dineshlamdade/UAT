<app-leftmenu></app-leftmenu>
<!-- Main body part  -->
<div class="page">
    <app-header></app-header>
    <div class="section-body mt-3">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <form [formGroup]="IdentityInfoForm">
                                <!-- Basic Identity Information -->
                                <fieldset>
                                    <legend>{{ 'IdentityInformationForm.basicIdentity' | transloco }}
                                    </legend>
                                    <div class="col-12">
                                        <div class="row">
                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{ 'IdentityInformationForm.aadhaarNo' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter Aadhaar"
                                                    formControlName="aadhaarNo"
                                                    [(ngModel)]="IdentityInformation.employeeMasterRequestDTO.aadhaar"
                                                    minlength="1" maxlength="12" (keypress)="keyPress($event)"
                                                    [ngClass]="{'is-invalid' : IdentityInfoForm.get('aadhaarNo').status == 'INVALID'}"
                                                    (keyup)="updateAadhaarName(IdentityInformation.employeeMasterRequestDTO.aadhaar)">
                                                <div class="invalid-error-message"
                                                    *ngIf="IdentityInfoForm.get('aadhaarNo').status == 'INVALID'">
                                                    Aadhar No. should be 12 digits.</div>
                                            </div>


                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{ 'IdentityInformationForm.aadhaarName' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter Aadhaar Name"
                                                    formControlName="aadhaarName"
                                                    [(ngModel)]="IdentityInformation.employeeMasterRequestDTO.nameAsPerAADHAAR">
                                            </div>

                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{ 'IdentityInformationForm.pan' | transloco
                                                    }}</label>
                                                <input type="text" class="form-control" placeholder="Enter PAN"
                                                    formControlName="pan"
                                                    [ngClass]="{'is-invalid' : IdentityInfoForm.get('pan').status == 'INVALID'}"
                                                    [(ngModel)]="IdentityInformation.employeeMasterRequestDTO.pan"
                                                    pattern="[a-zA-Z]{3}[P]{1}[a-zA-Z]{1}[0-9]{4}[a-zA-Z]{1}"
                                                    minlength="1" maxlength="10"
                                                    (ngModelChange)="IdentityInformation.employeeMasterRequestDTO.pan = $event?.toUpperCase()"
                                                    (keyup)="updatePANName(IdentityInformation.employeeMasterRequestDTO.pan)">
                                                <div class="invalid-error-message"
                                                    *ngIf="IdentityInfoForm.get('pan').status == 'INVALID'">
                                                    5 Character, 4 Numbers, 1 Character</div>
                                            </div>

                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{ 'IdentityInformationForm.panName' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter PAN Name"
                                                    formControlName="panName"
                                                    [(ngModel)]="IdentityInformation.employeeMasterRequestDTO.nameAsPerPAN">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{ 'IdentityInformationForm.uan' | transloco
                                                    }}</label>
                                                <input type="text" class="form-control" placeholder="Enter UAN"
                                                    minlength="1" maxlength="12" formControlName="uan"
                                                    (keypress)="keyPress($event)"
                                                    [ngClass]="{'is-invalid' : IdentityInfoForm.get('uan').status == 'INVALID'}"
                                                    [(ngModel)]="IdentityInformation.employeeMasterRequestDTO.uan"
                                                    (keyup)="updateUANName(IdentityInformation.employeeMasterRequestDTO.uan)">
                                                <div class="invalid-error-message"
                                                    *ngIf="IdentityInfoForm.get('uan').status == 'INVALID'">
                                                    Aadhar No. should be 12 digits.</div>

                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{ 'IdentityInformationForm.uanName' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter UAN Name"
                                                    formControlName="uanName"
                                                    [(ngModel)]="IdentityInformation.employeeMasterRequestDTO.nameAgainstUAN">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{ 'IdentityInformationForm.voterId' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter Voter ID"
                                                    formControlName="voterId"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.electionCardNo"
                                                    (keyup)="updateVoterIdName(IdentityInformation.employeePersonalInfoRequestDTO.electionCardNo)">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{ 'IdentityInformationForm.voterIdName' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control"
                                                    placeholder="Enter Voter ID Name" formControlName="voterIdName"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.nameAsperElectionCard">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{
                                                    'IdentityInformationForm.nationalPopulationRegNumber' | transloco
                                                    }}</label>
                                                <input type="text" class="form-control" placeholder="Enter NPR Number"
                                                    formControlName="nationalPopulationRegNumber"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.nprNumber"
                                                    (keyup)="updateNPRName(IdentityInformation.employeePersonalInfoRequestDTO.nprNumber)">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{
                                                    'IdentityInformationForm.nameNationalPopulationRegNumber' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter NPR Name"
                                                    formControlName="nameNationalPopulationRegNumber"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.nameAsPerNPR">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{ 'IdentityInformationForm.esicIP' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter ESICIP"
                                                    formControlName="esicIP"
                                                    [(ngModel)]="IdentityInformation.employeeESICDTORequestDTO.eSICCode">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{ 'IdentityInformationForm.pranForNPS' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter PRAN"
                                                    minlength="1" maxlength="12" formControlName="pranForNPS"
                                                    (keypress)="keyPress($event)" (keypress)="keyPress($event)"
                                                    [ngClass]="{'is-invalid' : IdentityInfoForm.get('pranForNPS').status == 'INVALID'}"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.pran">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{ 'IdentityInformationForm.drivingLicenceNo'
                                                    | transloco }}</label>
                                                <input type="text" class="form-control"
                                                    placeholder="Enter Driving Licence No."
                                                    formControlName="drivingLicenceNo"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.drivingLicenseNo"
                                                    (keyup)="updateDrivingName(IdentityInformation.employeePersonalInfoRequestDTO.drivingLicenseNo)">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{
                                                    'IdentityInformationForm.nameDrivingLicence' | transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter Name"
                                                    formControlName="nameDrivingLicence"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.nameasperDrivingLicense">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{
                                                    'IdentityInformationForm.drivingLicenceExpiryDate' | transloco
                                                    }}</label>
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text"><i
                                                                    class="fa fa-calendar"></i></span>
                                                        </div>
                                                        <input [bsConfig]="{ dateInputFormat: 'DD-MMM-YYYY' }"
                                                            data-provide="datepicker" data-date-autoclose="true"
                                                            class="form-control" placeholder="Select Date" bsDatepicker
                                                            [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.drivingLicenseExpiryDate"
                                                            formControlName="drivingLicenceExpiryDate"
                                                            [minDate]="today">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                                <br>
                                <!-- Valid Passport Information -->
                                <fieldset>
                                    <legend>{{ 'IdentityInformationForm.passportInformationTitle' | transloco }}
                                    </legend>
                                    <div class="col-12">
                                        <div class="row">
                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{ 'IdentityInformationForm.passportNo' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter Number"
                                                    formControlName="passportNo"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.passportNo"
                                                    (keyup)="updatePassportName(IdentityInformation.employeePersonalInfoRequestDTO.passportNo)">
                                            </div>

                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{ 'IdentityInformationForm.namePassport' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control" placeholder="Enter Name"
                                                    formControlName="namePassport"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.nameAsPerPassport">
                                            </div>

                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{
                                                    'IdentityInformationForm.passportInfoCountry' | transloco }}</label>
                                                <select class="form-control" placeholder="Select Country"
                                                    formControlName="passportInfoCountry"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.countryOfOrigin">
                                                    <option value="" selected disabled>Select Country</option>
                                                    <option *ngFor="let country of countryList" [value]="country">
                                                        {{country}}
                                                    </option>
                                                </select>
                                            </div>

                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{ 'IdentityInformationForm.placeOfIssue' |
                                                    transloco }}</label>
                                                <input type="text" class="form-control"
                                                    placeholder="Enter place of issue" formControlName="placeOfIssue"
                                                    [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.passportPlaceOfIssue">
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{ 'IdentityInformationForm.dateOfIssue' |
                                                    transloco }}</label>
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text"><i
                                                                    class="fa fa-calendar"></i></span>
                                                        </div>
                                                        <input [bsConfig]="{ dateInputFormat: 'DD-MMM-YYYY' }"
                                                            data-provide="datepicker" data-date-autoclose="true"
                                                            class="form-control" placeholder="Select Date" bsDatepicker
                                                            formControlName="dateOfIssue" [maxDate]="today"
                                                            [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.passportValidFrom">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6 col-md-3 mt-10">
                                                <label class="form-label">{{ 'IdentityInformationForm.expiryDate' |
                                                    transloco }}</label>
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text"><i
                                                                    class="fa fa-calendar"></i></span>
                                                        </div>
                                                        <input [bsConfig]="{ dateInputFormat: 'DD-MMM-YYYY' }"
                                                            data-provide="datepicker" data-date-autoclose="true"
                                                            class="form-control" placeholder="Select Date" bsDatepicker
                                                            formControlName="expiryDate" [minDate]="today"
                                                            [(ngModel)]="IdentityInformation.employeePersonalInfoRequestDTO.passportExpiryDate">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                                <br>

                                <!-- Valid Passport Information -->
                                <fieldset>
                                    <legend>{{ 'IdentityInformationForm.VISAInformationTitle' | transloco }}
                                    </legend>
                                    <div class="col-12">
                                        <div class="row">
                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{
                                                    'IdentityInformationForm.passportInfoCountry' | transloco }}</label>
                                                <select class="form-control" placeholder="Select"
                                                    formControlName="visaInfoCountry"
                                                    [(ngModel)]="VisaInformation.countryName">
                                                    <option value="" selected disabled>Select</option>
                                                    <option *ngFor="let country of countryList" [value]="country">
                                                        {{country}}
                                                    </option>
                                                </select>
                                            </div>

                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{ 'IdentityInformationForm.typeOfVisa' |
                                                    transloco }}</label>
                                                <select class="form-control" placeholder="Select"
                                                    formControlName="typeOfVisa" [(ngModel)]="VisaInformation.visaType">
                                                    <option value="" selected disabled>Select</option>
                                                    <option *ngFor="let visaType of visaTypeList" [value]="visaType">
                                                        {{visaType}}
                                                    </option>
                                                </select>
                                            </div>

                                            <div class="col-sm-6 col-md-3">
                                                <label class="form-label">{{ 'IdentityInformationForm.validTill' |
                                                    transloco }}</label>
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text"><i
                                                                    class="fa fa-calendar"></i></span>
                                                        </div>
                                                        <input [bsConfig]="{ dateInputFormat: 'DD-MMM-YYYY' }"
                                                            data-provide="datepicker" data-date-autoclose="true"
                                                            class="form-control" placeholder="Select Date" bsDatepicker
                                                            formControlName="validTill" [minDate]="today"
                                                            [(ngModel)]="VisaInformation.validTill">
                                                    </div>
                                                </div>
                                            </div>

                                            <i class="icon-plus add-icon" [class.disabled]="VisaInformation.countryName=='' || VisaInformation.visaType==''
                                            || !VisaInformation.validTill" [ngClass]="{'invalid-add-button':VisaInformation.countryName ==''
                                            || VisaInformation.visaType=='' || VisaInformation.validTill=='','valid-add-button':VisaInformation.countryName 
                                            || VisaInformation.visaType || VisaInformation.validTill}"
                                                (click)="pushToGrid()"></i>
                                            <!-- <mat-icon [ngClass]="{'disable':!VisaInformation.countryName || !VisaInformation.visaType
                                            || !VisaInformation.validTill, 'invalid-add-button':!VisaInformation.countryName 
                                            || !VisaInformation.visaType || !VisaInformation.validTill,'valid-add-button':VisaInformation.countryName 
                                            || VisaInformation.visaType || VisaInformation.validTill}" (click)="pushToGrid()">
                                                    add_circle_outline</mat-icon> -->
                                        </div>

                                        <div class="row mt-20">
                                            <div class="col-md-12">
                                                <div class="table-responsive Custom_Table">
                                                    <table class="table table-striped table-hover table-bordered m-b-0">
                                                        <thead class="thead-dark">
                                                            <tr>
                                                                <th scope="col" class="font700 wd-30">Country</th>
                                                                <th scope="col" class="font700 wd-30">Type of Visa</th>
                                                                <th scope="col" class="font700 wd-30">Valid Till</th>
                                                                <th scope="col" class="font700 wd-10">Action</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr *ngFor="let visa of data">
                                                                <td><span>{{visa.countryName}}</span></td>
                                                                <td><span>{{visa.visaType}}</span></td>
                                                                <td><span>{{visa.validTill}}</span></td>

                                                                <td><i class="fa fa-pencil font-16 text-blue cursor-pointer"
                                                                        tooltip="Edit"
                                                                        (click)="editVisaInfo(visa)"></i>&nbsp;&nbsp;
                                                                    <i class="fa fa-times font-16 text-red cursor-pointer"
                                                                        tooltip="Delete"
                                                                        (click)="removeVisaItem(visa, confirmation)"></i>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>

                                <div class="row mt-15">
                                    <div class="col-12">
                                        <div class="float-right mb-15">
                                            <button type="button" tooltip="Previous"
                                                [routerLink]="['/employee-master/job-information/job-summary']"
                                                class="custom_button custom_btn btn-labeled btn-labeled-left ml-10 bg-teal-400"><b><i
                                                        class="fa fa-chevron-circle-left"
                                                        aria-hidden="true"></i></b>Previous</button>

                                            <button type="button" tooltip="Next"
                                                [routerLink]="['/employee-master/compliance-information/compliance-summary']"
                                                class="custom_button custom_btn btn-labeled btn-labeled-left ml-15 mr-15 bg-teal-400"><b><i
                                                        class="fa fa-chevron-circle-right"
                                                        aria-hidden="true"></i></b>Next</button>

                                            <button type="button" (click)="IdentitySaveNextSubmit(IdentityInformation)"
                                                [disabled]="IdentityInfoForm.invalid || IdentityInfoForm.untouched"
                                                class="custom_button custom_btn btn-labeled btn-labeled-left mr-15"
                                                tooltip="Save & Next" [ngClass]="{'disabled-btn-bg-green' : IdentityInfoForm.invalid || IdentityInfoForm.untouched,
                           'btn-bg-green': !IdentityInfoForm.invalid}"><b><i class="fa fa-floppy-o"></i></b>
                                                Save & Next</button>

                                            <button type="submit"
                                                [disabled]="IdentityInfoForm.invalid || IdentityInfoForm.untouched"
                                                (click)="IdentityInfoFormSubmit(IdentityInformation)"
                                                class="custom_button custom_btn btn-labeled btn-labeled-left"
                                                tooltip="Save" [ngClass]="{'disabled-btn-bg-green' : IdentityInfoForm.invalid || IdentityInfoForm.untouched,
                           'btn-bg-green': !IdentityInfoForm.invalid}"><b><i class="fa fa-floppy-o"></i></b>
                                                Save</button>


                                            <button type="button" tooltip="Reset" (click)="resetForm()"
                                                class="custom_button custom_btn bg-teal-400 btn-labeled btn-labeled-left ml-10"><b><i
                                                        class="fa fa-refresh" aria-hidden="true"></i></b>
                                                Reset</button>
                                            <!-- <button type="button" *ngIf="isCancel" (click)="cancelView()"
                                             class="custom_button custom_btn bg-btn-red btn-labeled btn-labeled-left ml-10"
                                             tooltip="Cancel"><b><i class="fa fa-times-circle" ></i></b> Cancel</button> -->
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<ng-template #confirmation>
    <div class="modal-header">
        <h5 class="modal-title" id="UploadModalLabel">Confirmation</h5>
        <button type="button" (click)="modalRef.hide()" class="close" data-dismiss="modal" aria-label="Close"><span
                aria-hidden="true">Ã—</span></button>
    </div>
    <div class="modal-body">
        <div class="card">
            <div class="card-body">
                <div class="row clearfix">
                    <label class="form-label">{{confirmationMsg}}</label>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">No</button>
        <button type="button" class="btn btn-secondary" (click)="deleteRecord()">Yes</button>

    </div>
</ng-template>