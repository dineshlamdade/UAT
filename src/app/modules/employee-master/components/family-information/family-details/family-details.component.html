<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form [formGroup]="FamilyDetailsInfoForm"
                        (ngSubmit)="FamilyDetailsInfoSubmit(personalInformationModel)">
                        <!-- Member Details -->
                        <fieldset>
                            <legend><i class="fa fa-users"></i>
                                Member Details</legend>
                            <div class="row">
                                <div class="row">
                                    &nbsp;&nbsp;
                                    <div class="circle thumbnail margin-top-img"
                                        (click)="fileInput.click($event, fileInput)">
                                        <div class="avatar-edit">
                                            <input type='file' id="imageUpload" accept=".png, .jpg, .jpeg" #fileInput
                                                (change)="uploadFile($event, fileInput)" hidden
                                                [(ngModel)]="selectedImg" formControlName="image" />
                                        </div>
                                        <img [src]="imageUrl">
                                        <h4 class="image-size-info img-height" tooltip="Size should be
                                        less than 1 MB">Select Image <p class="small-size">(Size should be
                                                less than 1 MB)</p>
                                        </h4>
                                    </div>
                                </div>
                                <!-- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -->
                                <div class="row family-first-line">
                                    <div class="col-sm-6 col-md-4">
                                        <label class="form-label">Name</label>
                                        <input type="text" class="form-control" placeholder="Enter Name"
                                            formControlName="familyMemberName"
                                            [(ngModel)]="familyMemberInfoRequestDTO.familyMemberName"
                                            [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('familyMemberName').status == 'INVALID'}">
                                    </div>
                                    <div class="col-sm-6 col-md-4">
                                        <label class="form-label">Birth Date</label>
                                        <div class="form-group">
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                                </div>
                                                <input [bsConfig]="{ dateInputFormat: 'DD-MMM-YYYY' }"
                                                    data-provide="datepicker" data-date-autoclose="true"
                                                    class="form-control" placeholder="  /   /" bsDatepicker
                                                    formControlName="dateOfBirth" [maxDate]="today"
                                                    [(ngModel)]="familyMemberInfoRequestDTO.dateOfBirth"
                                                    [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('dateOfBirth').status == 'INVALID'}"
                                                    (bsValueChange)="birthDateValidation(); birthD();validDate(familyMemberInfoRequestDTO.dateOfBirth)">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 col-md-4">
                                        <label class="form-label">Relationship</label>
                                        <select class="form-control custom-select" placeholder="Select"
                                            (completeMethod)="filterRelationship($event)" formControlName="relation"
                                            [(ngModel)]="familyMemberInfoRequestDTO.relation"
                                            placeholder="Enter Relationship" #relation
                                            [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('relation').status == 'INVALID'}"
                                            (change)="populateGender(relation)">
                                            <option value="" selected disabled>Select</option>
                                            <option *ngFor="let relationOption of relationshipList"
                                                [value]="relationOption">
                                                {{relationOption}}
                                            </option>
                                        </select>

                                        <!-- <p-autoComplete [suggestions]="filteredRelationshipList"
                                            (completeMethod)="filterRelationship($event)" formControlName="relation"
                                            [(ngModel)]="familyMemberInfoRequestDTO.relation"
                                            placeholder="Enter Relationship" #relation [dropdown]="true"
                                            [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('relation').status == 'INVALID'}"
                                            (onSelect)="populateGender(relation)">
                                        </p-autoComplete> -->

                                        <!-- <i class="fa fa-chevron-down down-arrow-icon"></i> -->
                                    </div>
                                    <div class="col-sm-6 col-md-4">
                                        <label class="form-label">Gender</label>
                                        <!-- <p-autoComplete [suggestions]="filteredallGendersList"
                                            (completeMethod)="filterGender($event)" formControlName="gender"
                                            [dropdown]="true" [(ngModel)]="familyMemberInfoRequestDTO.gender"
                                            placeholder="Select"
                                            [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('gender').status == 'INVALID'}">
                                        </p-autoComplete> -->

                                        <select class="form-control custom-select" placeholder="Select"
                                            (completeMethod)="filterGender($event)" formControlName="gender"
                                            [dropdown]="true" [(ngModel)]="familyMemberInfoRequestDTO.gender"
                                            placeholder="Select"
                                            [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('gender').status == 'INVALID'}">
                                            <option value="" selected disabled>Select</option>
                                            <option *ngFor="let gender of allGenders" [value]="gender">
                                                {{gender}}
                                            </option>
                                        </select>
                                    </div>

                                    <div class="col-sm-6 col-md-4">
                                        <label class="form-label">Marital Status</label>
                                        <select class="form-control custom-select" placeholder="Select"
                                            (completeMethod)="filterMaritalStatus($event)"
                                            formControlName="maritalStatus" [dropdown]="true"
                                            [(ngModel)]="familyMemberInfoRequestDTO.maritalStatus" placeholder="Select"
                                            [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('maritalStatus').status == 'INVALID'}">
                                            <option value="" selected disabled>Select</option>
                                            <option *ngFor="let marital of maritalStatusList" [value]="marital">
                                                {{marital}}
                                            </option>
                                        </select>

                                        <!-- <p-autoComplete [suggestions]="filteredmaritalStatusList"
                                            (completeMethod)="filterMaritalStatus($event)"
                                            formControlName="maritalStatus" [dropdown]="true"
                                            [(ngModel)]="familyMemberInfoRequestDTO.maritalStatus" placeholder="Select"
                                            [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('maritalStatus').status == 'INVALID'}">
                                        </p-autoComplete> -->
                                    </div>

                                    <div class="col-sm-6 col-md-4">
                                        <label class="form-label">Father / Husband Name</label>
                                        <input type="text" class="form-control" placeholder="Enter Name"
                                            formControlName="fatherHusbandName"
                                            [(ngModel)]="familyMemberInfoRequestDTO.fatherHusbandName"
                                            [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('fatherHusbandName').status == 'INVALID'}">
                                    </div>

                                    <div class="col-sm-6 col-md-4 mt-15">
                                        <label class="form-label">Aadhaar Number </label>
                                        <input type="text" class="form-control" placeholder="Enter Aadhaar No."
                                            minlength="1" maxlength="12" formControlName="aadhaar"
                                            [(ngModel)]="familyMemberInfoRequestDTO.aadhaar">
                                    </div>

                                    <div class="col-sm-6 col-md-4 mt-15">
                                        <label class="form-label">Name As Per Aadhaar</label>
                                        <input type="text" class="form-control" placeholder="Enter Name"
                                            formControlName="nameAsPerAadhaar"
                                            [(ngModel)]="familyMemberInfoRequestDTO.nameAsPerAadhaar">
                                    </div>

                                    <div class="col-sm-6 col-md-4 mt-15">
                                        <label class="form-label">Age Bracket</label>
                                        <select class="form-control custom-select" placeholder="Select"
                                            (completeMethod)="filterAgeBracket($event)" formControlName="ageBracket"
                                            [(ngModel)]="familyMemberInfoRequestDTO.ageBracket" [dropdown]="true"
                                            (change)="validateIsdependant()" placeholder="Select"
                                            [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('ageBracket').status == 'INVALID'}">
                                            <option value="" selected disabled>Select</option>
                                            <option *ngFor="let ageBracket of ageBracketList" [value]="ageBracket">
                                                {{ageBracket}}
                                            </option>
                                        </select>

                                        <!-- <p-autoComplete [suggestions]="filteredageBracketList"
                                            (completeMethod)="filterAgeBracket($event)" formControlName="ageBracket"
                                            [(ngModel)]="familyMemberInfoRequestDTO.ageBracket" [dropdown]="true"
                                            (change)="validateIsdependant()" placeholder="Select"
                                            [ngClass]="{'is-invalid' : FamilyDetailsInfoForm.get('ageBracket').status == 'INVALID'}">
                                        </p-autoComplete> -->
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6 col-md-3 mt-15 row-margin-left">
                                    <div class="form-group  mt-15">
                                        <legend>
                                            Dependent On Employee</legend>
                                        <div class="custom-controls-stacked">
                                            <label class="custom-control custom-radio custom-control-inline">
                                                <input type="radio" class="custom-control-input" value="yes"
                                                    (change)="dependentOnEmployeeValidation($event)"
                                                    formControlName="dependentOnEmployeeToggle"
                                                    [(ngModel)]="dependentOnEmployee">
                                                <span class="custom-control-label">Yes</span>
                                            </label>
                                            <label class="custom-control custom-radio custom-control-inline">
                                                <input type="radio" class="custom-control-input" value="no"
                                                    (change)="dependentOnEmployeeValidation($event)"
                                                    formControlName="dependentOnEmployeeToggle"
                                                    [(ngModel)]="dependentOnEmployee">
                                                <span class="custom-control-label">
                                                    No</span>
                                            </label>
                                        </div>
                                        <mat-error *ngIf="dependentOnEmployee == ''">
                                            Please Select Option</mat-error>
                                    </div>
                                </div>

                                <div class="col-sm-6 col-md-4 mt-15">
                                    <div class="form-group  mt-15">
                                        <legend>
                                            Part Of Company Mediclaim Insurance</legend>
                                        <div class="custom-controls-stacked">
                                            <label class="custom-control custom-radio custom-control-inline">
                                                <input type="radio" class="custom-control-input" value="yes"
                                                    (change)="companyMediclaimValidation($event)"
                                                    formControlName="companyMediclaimToggle"
                                                    [(ngModel)]="companyMediclaim">
                                                <span class="custom-control-label">Yes</span>
                                            </label>
                                            <label class="custom-control custom-radio custom-control-inline">
                                                <input type="radio" class="custom-control-input" value="no"
                                                    (change)="companyMediclaimValidation($event)"
                                                    formControlName="companyMediclaimToggle"
                                                    [(ngModel)]="companyMediclaim">
                                                <span class="custom-control-label">
                                                    No</span>
                                            </label>
                                        </div>
                                        <mat-error *ngIf="companyMediclaim == ''">
                                            Please Select Option</mat-error>
                                    </div>
                                </div>
                            </div>

                            <div class="row row-margin-left">
                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" name="example-checkbox1"
                                            checked formControlName="isActive" (change)="activeSetBoolean($event)"
                                            [(ngModel)]="IsActive">
                                        <span class="custom-control-label">Active</span>
                                    </label>
                                </div>
                                <div class="col-sm-6 col-md-3 mt-15 ml-35">
                                    <label class="form-label">Remark</label>
                                    <input type="text" class="form-control" placeholder="Enter Remark"
                                        formControlName="remark" [(ngModel)]="familyMemberInfoRequestDTO.remark">
                                </div>
                            </div>
                        </fieldset>
                        <br>
                        <!-- Address Details -->
                        <fieldset>
                            <legend><i class="fa fa-map-marker"></i>
                                Address Details</legend>
                            <div class="row">
                                <div class="col-sm-3 col-md-5">
                                    <label class="form-label">Phone No.</label>
                                    <div class="row">
                                        <div class="col-sm-3 col-md-4 country-code">
                                            <select class="form-control custom-select" placeholder="Select"
                                                [(ngModel)]="addressCountryCode" [dropdown]="true"
                                                (completeMethod)="filtercountryCode($event)"
                                                formControlName="addressDetailsCountryCode" placeholder="Select">
                                                <option value="" selected disabled>Select</option>
                                                <option *ngFor="let code of countryCode" [value]="code">
                                                    {{code}}
                                                </option>
                                            </select>

                                            <!-- <p-autoComplete [suggestions]="filteredcountryCode" #copyAddress
                                                [(ngModel)]="addressCountryCode" [dropdown]="true"
                                                (completeMethod)="filtercountryCode($event)"
                                                formControlName="addressDetailsCountryCode" placeholder="Select">
                                            </p-autoComplete> -->
                                        </div>
                                        <div class="col-sm-3 col-md-6">
                                            <input type="text" class="form-control" placeholder="Enter Phone No."
                                                minlength="1" maxlength="10"
                                                formControlName="addressDetailsMobileNumber"
                                                [(ngModel)]="addressPhoneNo">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-6 col-md-3">
                                    <label class="form-label">Copy From</label>
                                    <select class="form-control custom-select" placeholder="Select"
                                        (completeMethod)="filterCopyFromList($event)" formControlName="copyFrom"
                                        (onSelect)="getAddressFromCopyList($event)" placeholder="Select">
                                        <option value="" selected disabled>Select</option>
                                        <option *ngFor="let copyFrom of CopyFromAddressList" [value]="copyFrom">
                                            {{copyFrom}}
                                        </option>
                                    </select>

                                    <!-- <p-autoComplete [suggestions]="filteredCopyFromAddressList" #copyAddress
                                        (completeMethod)="filterCopyFromList($event)" formControlName="copyFrom"
                                        (onSelect)="getAddressFromCopyList($event)" placeholder="Select"
                                        [dropdown]="true">
                                    </p-autoComplete> -->

                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">Address 1</label>
                                    <input type="text" class="form-control" placeholder="Enter Adddress 1"
                                        formControlName="addressDetailsAddress1"
                                        [(ngModel)]="familyAddressDetailRequestDTO.address1">
                                </div>

                                <div class=" col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">Address 2</label>
                                    <input type="text" class="form-control" placeholder="Enter Adddress 2"
                                        formControlName="addressDetailsAddress2"
                                        [(ngModel)]="familyAddressDetailRequestDTO.address2">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">Address 3</label>
                                    <input type="text" class="form-control" placeholder="Enter Adddress 3"
                                        formControlName="addressDetailsAddress3"
                                        [(ngModel)]="familyAddressDetailRequestDTO.address3">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">Country</label>
                                    <input type="text" class="form-control" placeholder="Select"
                                        formControlName="addressDetailsCountry"
                                        [(ngModel)]="familyAddressDetailRequestDTO.country">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">PIN</label>
                                    <input type="text" class="form-control" placeholder="Enter PIN"
                                        formControlName="addressDetailsPin" (keyup)="AddressValidationFromPIN();"
                                        minlength="1" maxlength="6" pattern="[0-9]{6}"
                                        [(ngModel)]="familyAddressDetailRequestDTO.pinCode">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">State</label>
                                    <input type="text" class="form-control" placeholder="Select"
                                        formControlName="addressDetailsMobileState"
                                        [(ngModel)]="familyAddressDetailRequestDTO.state">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">City</label>
                                    <input type="text" class="form-control" placeholder="Enter City"
                                        formControlName="addressDetailsCity"
                                        [(ngModel)]="familyAddressDetailRequestDTO.city">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">Village</label>
                                    <input type="text" class="form-control" placeholder="Enter Village"
                                        formControlName="addressDetailsVillege"
                                        [(ngModel)]="familyAddressDetailRequestDTO.village">
                                </div>
                            </div>
                        </fieldset>

                        <br>
                        <!-- Guardian Details -->
                        <fieldset *ngIf="familyMemberInfoRequestDTO.ageBracket == 'Minor'">
                            <legend><i class="fa fa-map-marker"></i>
                                Guardian Details</legend>
                            <div class="row">
                                <div class="col-sm-6 col-md-3">
                                    <label class="form-label">Guardian Name</label>
                                    <input type="text" class="form-control" placeholder="Enter Name"
                                        formControlName="guardianName"
                                        [(ngModel)]="guardianDetailRequestDTO.guardianName">
                                </div>

                                <div class="col-sm-3 col-md-4">
                                    <label class="form-label">Phone No.</label>
                                    <div class="row">
                                        <div class="col-sm-3 col-md-5 country-code">
                                            <select class="form-control custom-select" placeholder="Select"
                                                [(ngModel)]="guardianCountryCode" [dropdown]="true"
                                                (completeMethod)="filtercountryCode($event)"
                                                formControlName="guardianCountryCode" placeholder="Select">
                                                <option value="" selected disabled>Select</option>
                                                <option *ngFor="let code of countryCode" [value]="code">
                                                    {{code}}
                                                </option>
                                            </select>

                                            <!-- <p-autoComplete [suggestions]="filteredcountryCode"
                                                [(ngModel)]="guardianCountryCode" [dropdown]="true"
                                                (completeMethod)="filtercountryCode($event)"
                                                formControlName="guardianCountryCode" placeholder="Select">
                                            </p-autoComplete> -->
                                        </div>
                                        <div class="col-sm-3 col-md-6">
                                            <input type="text" class="form-control" placeholder="Enter Mobile No."
                                                minlength="1" maxlength="10" formControlName="guardianMobileNumber"
                                                [(ngModel)]="guardianPhoneNo">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">Address 1</label>
                                    <input type="text" class="form-control" placeholder="Enter Adddress 1"
                                        formControlName="guardianAddress1"
                                        [(ngModel)]="guardianDetailRequestDTO.address1">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">Address 2</label>
                                    <input type="text" class="form-control" placeholder="Enter Adddress 2"
                                        formControlName="guardianAddress2"
                                        [(ngModel)]="guardianDetailRequestDTO.address2">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">Address 3</label>
                                    <input type="text" class="form-control" placeholder="Enter Adddress 3"
                                        formControlName="guardianAddress3"
                                        [(ngModel)]="guardianDetailRequestDTO.address3">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">Country</label>
                                    <input type="text" class="form-control" placeholder="Select"
                                        formControlName="guardianCountry"
                                        [(ngModel)]="guardianDetailRequestDTO.country">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">PIN</label>
                                    <input type="text" class="form-control" placeholder="Enter PIN"
                                        formControlName="guardianPin" [(ngModel)]="guardianDetailRequestDTO.pincode"
                                        (keyup)="getGuardianAddressFromPIN();" minlength="1" maxlength="6"
                                        pattern="[0-9]{6}">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">State</label>
                                    <input type="text" class="form-control" placeholder="Select"
                                        formControlName="guardianState" [isRequired]="false"
                                        [(ngModel)]="guardianDetailRequestDTO.state">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">City</label>
                                    <input type="text" class="form-control" placeholder="Enter City"
                                        formControlName="guardianCity" [(ngModel)]="guardianDetailRequestDTO.city">
                                </div>

                                <div class="col-sm-6 col-md-3 mt-15">
                                    <label class="form-label">Village</label>
                                    <input type="text" class="form-control" placeholder="Enter Village"
                                        formControlName="guardianVillege"
                                        [(ngModel)]="guardianDetailRequestDTO.village">
                                </div>
                            </div>
                        </fieldset>

                        <div class="row mt-15">
                            <div class="col-12">
                                <div class="float-right mb-15">
                                    <button type="submit" [disabled]="FamilyDetailsInfoForm.invalid" [ngClass]="{'disabled-btn-bg-green' : FamilyDetailsInfoForm.invalid,
                                    'btn-bg-green': !FamilyDetailsInfoForm.invalid}" (click)="pushFamilyDetailsToGrid(familyMemberInfoRequestDTO, familyAddressDetailRequestDTO,
                    guardianDetailRequestDTO);" class="custom_button custom_btn btn-labeled btn-labeled-left"
                                        tooltip="Save" [hidden]="updateFormFlag || familyViewItem"><b><i
                                                class="fa fa-floppy-o"></i></b>Save</button>

                                    <button type="submit" [disabled]="FamilyDetailsInfoForm.invalid" [ngClass]="{'disabled-btn-bg-green' : FamilyDetailsInfoForm.invalid,
                                    'btn-bg-green': !FamilyDetailsInfoForm.invalid}" (click)="saveFamilyEditRow(familyMemberInfoRequestDTO, familyAddressDetailRequestDTO,
                    guardianDetailRequestDTO);" class="custom_button custom_btn btn-labeled btn-labeled-left"
                                        tooltip="Update" *ngIf="updateFormFlag"><b><i
                                                class="fa fa-floppy-o"></i></b>Update</button>

                                    <button type="button" tooltip="Reset" (click)="resetFamilyDetailsForm()"
                                        [hidden]="familyViewItem || updateFormFlag"
                                        class="custom_button custom_btn bg-teal-400 btn-labeled btn-labeled-left ml-10"><b><i
                                                class="fa fa-refresh" aria-hidden="true"></i></b>Reset</button>

                                    <button type="button" *ngIf="familyViewItem || updateFormFlag"
                                        (click)="cancelView()"
                                        class="custom_button custom_btn bg-btn-red btn-labeled btn-labeled-left ml-10"
                                        tooltip="Cancel"><b><i class="fa fa-times-circle"></i></b> Cancel</button>
                                </div>
                            </div>
                        </div>

                        <legend>Summary</legend>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive Custom_Table">
                                    <table class="table table-striped table-hover table-bordered m-b-0">
                                        <thead class="thead-dark">
                                            <tr>
                                                <th scope="col" class="font700 wd-30">Family Member Name</th>
                                                <th scope="col" class="font700 wd-30">Relationship</th>
                                                <th scope="col" class="font700 wd-30">Status</th>
                                                <th scope="col" class="font700 wd-20">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let family of FamilySummaryGridData">
                                                <td><span>{{family.familyMemberName}}</span></td>
                                                <td><span>{{family.relation}}</span></td>
                                                <td><span>{{family.isMemberActive}}</span></td>

                                                <td><i class="fa fa-pencil font-16 text-blue cursor-pointer  mr-10"
                                                        tooltip="Edit" (click)="editFamilyMember(family)"></i>

                                                    <i class="fa fa-eye font-16 text-blue cursor-pointer" tooltip="View"
                                                        (click)="viewFamilyMember(family)"></i>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>