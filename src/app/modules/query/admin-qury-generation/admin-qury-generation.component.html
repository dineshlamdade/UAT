<app-leftmenu></app-leftmenu>
<div class="page">
  <app-header></app-header>
  <div class="section-body mt-3">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <form [formGroup]="queryGenerationForm" (ngSubmit)="queryGenerationFormSubmit()">
                <div class="cardborder">
                  <div>
                    <div class="row">
                      <div class="col-md-12 pl-0 pr-0">
                        <div class="border-dark-card radius-10 p-2 mt-3">
                          <div class="row">
                            <div class="col-md-2">
                              <label class="form-label mt-1 mb-0" >Employee No. & Name </label >
                               <input type="text" class="form-control"  value="{{perticularEmpDetails.employeeCode  +''+  perticularEmpDetails.fullName}}"
                                disabled />
                            </div>
                            <div class="col-md-2">
                              <label class="form-label mt-1 mb-0">Date of Joining</label >
                              <input type="text" class="form-control" value="{{perticularEmpDetails.joiningDate|date: 'dd-MMM-yyyy'}}"
                               disabled />
                            </div>
                            <div class="col-md-2">
                              <label class="form-label mt-1 mb-0">Establishment</label  >

                              <input type="text" class="form-control" value="{{perticularEmpDetails.establishment}}" disabled />
                            </div>
                            <div class="col-md-2">
                              <label class="form-label mt-1 mb-0">Employee Type</label>
                              <input type="text" class="form-control" value="{{perticularEmpDetails.employeeType}}"  disabled />
                            </div>
                            <div class="col-md-1">
                              <label class="form-label mt-1 mb-0">Grade</label>
                              <input type="text" class="form-control" value="{{perticularEmpDetails.grade}}"  disabled />
                            </div>
                            <div class="col-md-2">
                              <label class="form-label mt-1 mb-0" >Designation</label >
                              <input type="text" class="form-control"  value="{{perticularEmpDetails.designation}}" disabled />

                            </div>
                            <div class="col-md-1">
                              <label class="form-label mt-1 mb-0">Status</label>
                              <input type="text" class="form-control"  value="{{perticularEmpDetails.status}}" disabled />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="row mt-25">
                      <div class="col-md-3">
                        <label class="form-label">Query No.</label>
                        <input type="text" class="form-control" formControlName="queryNumber" disabled />
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Submission Date & Time</label>
                        <div class="form-group">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">
                                <i class="fa fa-calendar"></i>
                              </span>
                            </div>
                            <input
                              data-provide="datepicker"
                              data-date-autoclose="true"
                              class="form-control"
                              placeholder="Date"
                              bsDatepicker
                              disabled  value="{{getAllQueryGenerationData.submissionDate |date: 'dd-MMM-yyyy' }}"
                            />
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Module Name</label>
                        <select
                          class="form-control" (change)="moduleChange($event.target.value)" >
                         <!-- [ngClass]="{'is-invalid' : queryGenerationForm.get('applicationModuleId').status == 'INVALID'}" -->
                          <option [ngValue]="null" selected >Select</option>
                          <option value="{{module.applicationModuleId}}" *ngFor="let module of moduleListData ">
                            {{module.applicationModuleName}}</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Query Type</label>
                        <select
                          name="Gender"
                          class="form-control custom-select" (change)="queryTypeChange($event.target.value)">
                          <option [ngValue]="null" selected >Select</option>
                          <option value="{{module.queryTypeMasterId}}" *ngFor="let module of querySubQueryTypeQAData ">{{module.queryTypeDescription}}</option>
                          <!-- <option value="LMS">Select</option>
                          <option value="Registration">Registration</option>
                          <option value="loan">Loan</option> -->
                        </select>
                      </div>
                    </div>
                    <div class="row mt-25">
                      <div class="col-md-3">
                        <label class="form-label">Sub-Query Type</label>
                        <select
                          name="Gender"
                          class="form-control custom-select" >
                          <option [ngValue]="null" selected >Select</option>
                          <option  *ngFor="let module of subQueryData"  value="{{module.subQueTypeMasterId}}">
                            {{module.subQueryTypeDescription}}</option>

                        </select>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Priority</label>
                        <select
                          name="Gender"
                          class="form-control custom-select" >
                          <option [ngValue]="null" selected >Select</option>
                          <option *ngFor="let module of priorityData" value="{{module.queTypePriorityMasterId}}">{{module.priorityType}}</option>

                        </select>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Escalation Date </label>
                        <div class="form-group">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">
                                <i class="fa fa-calendar"></i>
                              </span>
                            </div>
                            <input
                              data-provide="datepicker"
                              data-date-autoclose="true"
                              class="form-control"
                              placeholder="Date"
                              bsDatepicker
                              disabled value="{{getAllQueryGenerationData.escalationDate |date: 'dd-MMM-yyyy' }}"
                            />
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Query Template</label>
                        <select
                          name="Gender"
                          class="form-control custom-select">
                          <option [ngValue]="null" selected >Select</option>
                          <option *ngFor="let module of queryTemplateData " value="{{module.moduleId}}">{{module.description}}</option>
                          <!-- <option value="LMS">Select</option>
                          <option value="Registration">Registration</option>
                          <option value="loan">Loan</option> -->
                        </select>
                      </div>
                    </div>
                    <div class="row mt-25">
                      <div class="col-md-12">
                        <label class="form-label">Subject</label>
                        <input
                          type="text"
                          class="form-control"
                          placeholder="subject"
                          placeholder="Enter Subject"
                        />
                        <br />
                        <label class="form-label">Description</label>

                        <ckeditor> </ckeditor>
                      </div>
                    </div>
                    <div class="row mt-25">
                      <div class="col-md-6">
                        <div class="table-responsive Custom_Table">
                          <table
                            class="table table-striped table-hover table-bordered m-b-0"
                          >
                            <thead class="thead-dark">
                              <tr>
                                <th class="wd-4">Sr.No.</th>
                                <th>Attachment</th>
                                <th>Action</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let document of documentList ,let i = index;">
                                <td class="wd-9">{{i+1}}</td>
                                <td class="wd-14">{{document.documentName}}</td>
                                <td>
                                  <i class="fa fa-paperclip text-orange"></i> &nbsp;
                                  {{ document.fileName }}
                                </td>
                                <td>
                                  <i class="fa fa-upload font-16 text-blue cursor-pointer" tooltip="Upload"
                                    (click)="UploadModalDocument(template1, i,document)" data-toggle="modal"
                                    data-target="#UploadModal1"></i>&nbsp;&nbsp;
                                </td>
                              </tr>
                            </tbody>
                          </table>
                          <ng-template #template1>
                            <div class="modal-header">
                              <h5 class="modal-title" id="UploadModalLabel">Upload Document</h5>
                              <button type="button" (click)=" modalRef.hide(); " class="close" data-dismiss="modal"
                                aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                            </div>
                            <div class="modal-body">
                              <div class="card">
                                <div class="card-body">
                                  <div class="row clearfix">

                                    <div class="col-md-12">
                                      <div class="fileuploadbox bg-color-lightgray">
                                        <label class="filelabel">
                                          <i class="fa fa-upload">
                                          </i>
                                          <span class="title">
                                            Choose file
                                          </span>
                                          <input class="FileUpload1" class="dropify" (change)="onMasterUpload($event);"
                                            accept=".jpg , .jpeg, .pdf , .png" id="FileInput" type="file" multiple />
                                        </label>
                                      </div>
                                      <div *ngIf="masterfilesArray.length > 0 " class="fileuploadbox">
                                        Selected files
                                        <label *ngFor="let item of masterfilesArray;  let index = index;"
                                          class="filelabeldisplay">
                                          <div class="text-ellipsis"><i class="fa fa-paperclip">
                                            </i>
                                            <span class="title">
                                              {{ item.name }}
                                            </span>
                                          </div>
                                          <div>
                                            <i class="fa fa-times text-red font-18"
                                              (click)="removeSelectedLicMasterDocument(index)"></i>
                                          </div>
                                        </label>
                                      </div>
                                    </div>

                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">Ok</button>
                            </div>
                          </ng-template>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row mt-25">
                  <div class="col-md-12">
                    <div class="float-right">
                      <button
                        type="button"
                        tooltip="Reset"
                        class="custom_button custom_btn bg-teal-400 btn-labeled btn-labeled-left mr-10"
                      >
                        <b><i class="fa fa-angle-double-left"></i></b> Previous
                      </button>
                      <button
                        type="button"
                        tooltip="Button"
                        class="custom_button custom_btn btn-bg-green btn-labeled btn-labeled-left mr-10"
                      >
                        <b><i class="fa fa-file"></i></b> Save Draft & Next
                      </button>
                      <button
                        type="button"
                        tooltip="Button"
                        class="custom_button custom_btn btn-bg-green btn-labeled btn-labeled-left mr-10"
                      >
                        <b><i class="fa fa-file"></i></b> Save Draft
                      </button>
                      <button
                        type="button"
                        tooltip="Button"
                        class="custom_button custom_btn btn-bg-green btn-labeled btn-labeled-left mr-10"
                      >
                        <b><i class="fa fa-save"></i></b> Save & Next
                      </button>
                      <button type="submit" class="custom_button custom_btn btn-labeled btn-labeled-left" *ngIf="isSave"
                      tooltip="Save"[disabled]="!queryGenerationForm.valid"
                       [ngClass]="{'disabled-btn-bg-green' : queryGenerationForm.invalid,'btn-bg-green': !queryGenerationForm.invalid}">
                       <b> <i class="fa fa-floppy-o" aria-hidden="true"></i></b>Save</button>&nbsp;
                      <button
                        type="button"
                        tooltip="Reset"
                        *ngIf="isReset" (click)="reset()"
                        class="custom_button custom_btn bg-teal-400 btn-labeled btn-labeled-left mr-10">
                        <b><i class="fa fa-refresh"></i></b> Reset </button>

                        <button type="submit" tooltip="Update"class="custom_button custom_btn btn-labeled btn-labeled-left"
                        [disabled]="!queryGenerationForm.valid" *ngIf="isUpdate"
                          [ngClass]="{'disabled-btn-bg-green' : queryGenerationForm.invalid,'btn-bg-green': !queryGenerationForm.invalid}">
                          <b> <i class="fa fa-floppy-o" aria-hidden="true"></i></b>Update</button
                         >&nbsp;
                      <button
                        type="button"
                        tooltip="Cancel" (click)="cancel()"
                        class="custom_button custom_btn bg-btn-red btn-labeled btn-labeled-left mr-10">
                        <b><i class="fa fa-times"></i></b> Cancel
                      </button>


                      <button
                        type="button"
                        tooltip="Reset"
                        class="custom_button custom_btn bg-teal-400 btn-labeled btn-labeled-left mr-10"
                      >
                        <b><i class="fa fa-angle-double-right"></i></b> Next
                      </button>
                    </div>
                  </div>
                </div>
                <div class="tabview-contents">
                  <div class="row">
                    <div class="col-md-12">
                      <h3 class="font-14 text-purple font-bold">Summary</h3>
                      <div class="table-responsive Custom_Table mt-25">
                        <p-table [value]="getAllQueryGenerationData"  [rows]="10" [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]"
                        [paginator]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">
                          <ng-template pTemplate="header">
                            <tr>
                              <th class="wd-14">Sr. No.</th>
                              <th class="wd-15">
                                <div class="p-d-flex p-jc-between p-ai-center">
                                  Query No.
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="name" pSortableColumn="queryNumber"></p-sortIcon>
                                    <p-columnFilter
                                      type="text"
                                      field="queryNumber"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div class="p-d-flex p-jc-between p-ai-center">
                                  Submission Date
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="date" pSortableColumn="submissionDate"></p-sortIcon>
                                    <p-columnFilter
                                      type="date"
                                      field="submissionDate"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div class="p-d-flex p-jc-between p-ai-center">
                                  Creator Name
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="date" pSortableColumn="createdBy"></p-sortIcon>
                                    <p-columnFilter
                                      type="date"
                                      field="createdBy"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div class="p-d-flex p-jc-between p-ai-center">
                                  Employee Code
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="status" pSortableColumn="employeeCode"></p-sortIcon>
                                    <p-columnFilter
                                      field="employeeCode"
                                      matchMode="equals"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-24">
                                <div
                                  class="p-d-flex justify-content-center p-ai-center"
                                >
                                  Employee Name
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="activity" pSortableColumn="empName"></p-sortIcon>
                                    <p-columnFilter
                                      field="empName"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div class="p-d-flex p-jc-between p-ai-center">
                                  Company Name
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="activity" pSortableColumn="companyName"></p-sortIcon>
                                    <p-columnFilter
                                      field="companyName"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div class="p-d-flex p-jc-between p-ai-center">
                                  <span tooltip="Unit of Measure"
                                    >Module Name</span
                                  >
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="activity" pSortableColumn="applicationModuleName"></p-sortIcon>
                                    <p-columnFilter
                                      field="applicationModuleName"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div class="p-d-flex p-jc-between p-ai-center">
                                  <span tooltip="Unit of Measure"
                                    >Query Type</span
                                  >
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="activity" pSortableColumn="queryTypeCode"></p-sortIcon>
                                    <p-columnFilter
                                      field="queryTypeCode"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div
                                  class="p-d-flex p-ai-center justify-content-center"
                                >
                                  Sub-Query Type
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="activity" pSortableColumn="subQueryTypeCode"></p-sortIcon>
                                    <p-columnFilter
                                      field="subQueryTypeCode"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div
                                  class="p-d-flex p-ai-center justify-content-center"
                                >
                                  Subject
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="activity" pSortableColumn="subject"></p-sortIcon>
                                    <p-columnFilter
                                      field="subject"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div
                                  class="p-d-flex p-ai-center justify-content-center"
                                >
                                  Priority
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="activity" pSortableColumn="priority"></p-sortIcon>
                                    <p-columnFilter
                                      field="priority"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div
                                  class="p-d-flex p-ai-center justify-content-center"
                                >
                                  Escalation Date
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="activity" pSortableColumn="escalationDate"></p-sortIcon>
                                    <p-columnFilter
                                      field="escalationDate"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-15">
                                <div
                                  class="p-d-flex p-ai-center justify-content-center"
                                >
                                  Status
                                  <div class="Sort_Filter_Position">
                                    <p-sortIcon field="activity" pSortableColumn="status"></p-sortIcon>
                                    <p-columnFilter
                                      field="status"
                                      display="menu"
                                      class="p-ml-auto"
                                    >
                                    </p-columnFilter>
                                  </div>
                                </div>
                              </th>
                              <th class="wd-25">Action</th>
                            </tr>
                          </ng-template>
                          <ng-template pTemplate="body" let-queryGenerationSummary let-rowIndex="rowIndex">
                            <tr class="p-selectable-row">
                              <td class="text-center">{{ rowIndex + 1 }}</td>
                              <td>
                                <label class="form-lable mb-0">{{ queryGenerationSummary.queryNumber}}</label>
                              </td>
                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.submissionDate | date :"dd-MMM-yyyy"
                                }}</label>
                              </td>
                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.createdBy
                                }}</label>
                              </td>
                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.employeeCode
                                }}</label>
                              </td>

                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.empName
                                }}</label>
                              </td>
                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.companyName
                                }}</label>
                              </td>

                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.applicationModuleName
                                }}</label>
                              </td>
                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.queryTypeCode
                                }}</label>
                              </td>
                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.subQueryTypeCode
                                }}</label>
                              </td>
                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.subject
                                }}</label>
                              </td>
                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.priority
                                }}</label>
                              </td>
                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.escalationDate |date:"dd-MMM-yyyy"
                                }}</label>
                              </td>
                              <td>
                                <label class="form-lable mb-0">{{
                                  queryGenerationSummary.status
                                }}</label>
                              </td>
                              <td>
                                <span class="ml-1 mt-2">
                                  <i class="fa fa-eye" tooltip="View" aria-hidden="true" style="color:darkcyan" (click)="viewQuery(queryGenerationSummary)"></i
                                    >&nbsp;
                                    <i class="fa fa-edit" tooltip="Edit" aria-hidden="true" (click)="editQuery(queryGenerationSummary)"></i
                                    >&nbsp;
                                    <i class="fa fa-trash" tooltip="Edit" aria-hidden="true" (click)="getDeleteById()" ></i
                                      >&nbsp;</span>
                                      <!--  -->
                              </td>
                            </tr>
                          </ng-template>
                          <ng-template pTemplate="emptymessage">
                            <tr>
                              <td
                                colspan="15"
                                class="font-14 font500 text-center text-red"
                              >
                                <span>No Data Available</span>
                              </td>
                            </tr>
                          </ng-template>
                        </p-table>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
