<app-leftmenu></app-leftmenu>
<div class="page">
  <app-header></app-header>
  <div class="section-body mt-3">
    <div class="container-fluid">


      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-body" style="border:1px solid rgb(189, 175, 175)">
              <form [formGroup]="AddLoanForm" (ngSubmit)="addloanFormSubmit()">
                <fieldset>
                  <legend>Employee Details</legend>
                  <div class="col-md-12 pl-0 pr-0">
                    <div class="border-dark-card radius-10 p-2">
                      <div class="row">
                        <div class="col-md-3">
                          <label class="form-label mt-1 mb-0" >Emp. Code</label >
                            <label class="font-12 text-ellipsis mt-1 mb-0">
                              0001</label>
                        </div>
                        <div class="col-md-3">
                          <label class="form-label mt-1 mb-0">Emp. Name</label >
                          <label class="font-12 text-ellipsis mt-1 mb-0">ABC</label>
                        </div>
                        <div class="col-md-3">
                          <label class="form-label mt-1 mb-0">Loan No.</label  >
                            <label class="font-12 text-ellipsis mt-1 mb-0">1111</label  >
                         
                        </div>
                        <div class="col-md-3">
                          <label class="form-label mt-1 mb-0">Application Date</label>
                          <label class="font-12 text-ellipsis mt-1 mb-0">11-Jan-2021</label  >
                          <!-- <input type="text" class="form-control" value="Worker"  disabled /> -->
                        </div>
                        
                      </div>
                    </div>
                  </div>
              </fieldset>
              <br>
                <fieldset>
                  <legend>Loan Details</legend>
                  <div class="row">
                    <!-- <div class="col-md-3">
                      <label class="form-label">Loan No.</label>
                      <input type="text" class="form-control" disabled />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Loan Application Date</label>
                      <input type="text" class="form-control" disabled />
                    </div> -->
                    <div class="col-md-3">
                      <label class="form-label">Loan Type</label>
                      <input type="text" class="form-control" formControlName="repaymentType"
                      disabled />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Repayment Type</label>
                      <input type="text" class="form-control" formControlName="repaymentType"
                         disabled />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Underline Asset Value</label>
                      <input type="text" class="form-control" formControlName="underlineAssestValue"
                        [ngClass]="{'is-invalid' : AddLoanForm.get('underlineAssestValue').status == 'INVALID'}"
                         disabled />
                    </div>

                    <div class="col-md-3">
                      <label class="form-label">Car Type</label>
                      <input type="text" class="form-control" formControlName="repaymentType"
                         disabled />
                    </div>
                  </div>
                  <br>
                  <div class="row">

                    <div class="col-md-3">
                      <label class="form-label">Loan Amount</label>
                      <input type="text" class="form-control" formControlName="loanAmount" 
                        value="{{loanAmount | number:'1.2-2'}}" />
                      <label style="font-size: 10px;">As per Policy :- 5,00,000</label>


                    </div>
                   

                    <div class="col-md-3">
                      <label class="form-label">Interest Rate (%) Per Annum</label>
                      <input type="text" class="form-control" formControlName="loanAmount" 
                        value="{{loanAmount | number:'1.2-2'}}" />
                        <!-- <span style="font-size: 11px; font-weight:500;">PA</span> -->
                        <label style="font-size: 10px;">As per Policy :12%</label>


                    </div>
                    <div class="col-md-3" *ngIf="!flatIntrestVisible">
                      <label class="form-label">No. of Installments</label>
                      <input type="text" class="form-control" formControlName="noOfInstallment"
                         />
                      <label style="font-size: 10px;">As per Policy :- 48</label>

                    </div>
                    <div class="col-md-3" *ngIf="!flatIntrestVisible">
                      <label class="form-label">Installment Amount</label>
                      <input type="text" class="form-control" formControlName="installmentAmount"
                        />
                      <label style="font-size: 10px;">As per Policy :- 45234</label>

                    </div>

                  </div>
                  <br />
                  <div class="row">

                    
                    <div class="col-md-3">
                      <label class="form-label">End Date</label>
                      <input type="text" class="form-control" formControlName="endDate" disabled />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Remark</label>
                      <input type="text" class="form-control" formControlName="remark"  disabled />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">External Referance No.</label>
                      <input type="text" class="form-control" formControlName="externalReferenceNumber"
                        disabled />
                    </div>
                  </div>
                <br/>
                  <div class="row">
                    <div class=" col-md-6">
                      <fieldset>
                        <legend>Guarantor Details</legend>


                        <div class="table-responsive Custom_Table">
                          <table class="table table-striped table-bordered table-hover bg-color-light_gray m-b-0">
                            <thead class="thead-dark">
                              <tr>
                                <!-- <th scope="col">Sr .No.</th> -->
                                <th scope="col">Emp.Code</th>
                                <th scope="col">Name</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <!-- <td>{{i+1}}</td> -->
                                <td>001</td>
                                <td>Jhon</td>
                              </tr>
                              <tr>
                                <!-- <td>{{i+1}}</td> -->
                                <td>002</td>
                                <td>AAA</td>
                              </tr>
                              <tr>
                                <!-- <td>{{i+1}}</td> -->
                                <td>003</td>
                                <td>BBB</td>
                              </tr>
                            </tbody>
                          </table>
                        </div>

                      </fieldset>
                    </div>
                    <div class="col-md-6">
                      <fieldset>
                        <legend>Deviation </legend>


                        <div class="table-responsive Custom_Table">
                          <table class="table table-striped table-bordered table-hover m-b-0 bg-color-light_gray">
                            <thead class="thead-dark">
                              <tr>
                                <th scope="col">Deviation Types</th>
                                <th scope="col">User Input</th>
                                <th scope="col">Limit</th>
                                <th scope="col">Deviation Value</th>
                                <th scope="col">Reason</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr >
                                <td>
                                   Loan Amount                       </td>
                                <td>222,222.00</td>
                                <td>500,000.00</td>
                                <td>100,000.00</td>
                                <!-- <td >{{data.userLimit - data.deviationValue | number:'1.2-2'}}</td> -->
                                <td style="background-color: #fff;">ABC</td>
                                <!-- [ngClass]="{'is-invalid' : AddLoanForm.get('reason').status == 'INVALID'}" formControlName="reason" -->
                              </tr>

                              <tr >
                                <td>
                                  No.Of Installments</td>
                                <td>11</td>
                                <td>12</td>
                                <td>13</td>
                                <!-- <td >{{data.userLimit - data.deviationValue | number:'1.2-2'}}</td> -->
                                <td style="background-color: #fff;">BBB</td>
                                <!-- [ngClass]="{'is-invalid' : AddLoanForm.get('reason').status == 'INVALID'}" formControlName="reason" -->
                              </tr>

                              <tr >
                                <td>
                                 Interest Rate</td>
                                <td>6.00%</td>
                                <td>4.00%</td>
                                <td>0</td>
                                <!-- <td >{{data.userLimit - data.deviationValue | number:'1.2-2'}}</td> -->
                                <td style="background-color: #fff;">CCC</td>
                                <!-- [ngClass]="{'is-invalid' : AddLoanForm.get('reason').status == 'INVALID'}" formControlName="reason" -->
                              </tr>
    
                            </tbody>
                          </table>
                        </div>

                      </fieldset>
                    </div>
                  </div>
<br/>
                  <div class="row">
                    <div class="col-md-6">
                      <fieldset>
                        <legend>Document </legend>


                        <div class="table-responsive Custom_Table">

                          <table class="table table-striped table-bordered table-hover m-b-0">
                            <thead class="thead-dark">
                              <tr>
                                <!-- <th scope="col" >Sr .No.</th> -->
                                <th scope="col">Name Of Document</th>
                                <th scope="col">Attachment</th>
                                <th scope="col">Remark</th>
                                <th scope="col">Action</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <!-- <td class="wd-9">{{i+1}}</td> -->
                                <td>Adhar card</td>

                                <td>
                                  <a><i class="fa fa-paperclip text-orange"></i> &nbsp;
                                    Adhar Copy Doc</a>
                                </td>
                                <td>
                                  ABC Remark
                                <td>
                                  <i class="fa fa-upload font-16 text-blue cursor-pointer" tooltip="Upload"
                                    (click)="UploadModalDocument(template1, i,document)" data-toggle="modal"
                                    data-target="#UploadModal1"></i>&nbsp;&nbsp;
                                </td>

                              </tr>

                            </tbody>
                          </table>
                          <ng-template #template1>
                            <div class="modal-header">
                              <h5 class="modal-title" id="UploadModalLabel">Upload Document</h5>
                              <button type="button" (click)=" modalRef.hide(); " class="close" data-dismiss="modal"
                                aria-label="Close"><span aria-hidden="true">×</span></button>
                            </div>
                            <div class="modal-body">
                              <div class="card">
                                <div class="card-body">
                                  <div class="row clearfix">

                                    <div class="col-md-12">
                                      <div class="fileuploadbox bg-color-lightgray">
                                        <label class="filelabel">
                                          <i class="fa fa-upload">
                                          </i>
                                          <span class="title">
                                            Choose file
                                          </span>
                                          <input class="FileUpload1" class="dropify" (change)="onMasterUpload($event);"
                                            accept=".jpg , .jpeg, .pdf , .png" id="FileInput" type="file" multiple />
                                        </label>
                                      </div>
                                      <div *ngIf="masterfilesArray.length > 0 " class="fileuploadbox">
                                        Selected files
                                        <label *ngFor="let item of masterfilesArray;  let index = index;"
                                          class="filelabeldisplay">
                                          <div class="text-ellipsis"><i class="fa fa-paperclip">
                                            </i>
                                            <span class="title">
                                              {{ item.name }}
                                            </span>
                                          </div>
                                          <div>
                                            <i class="fa fa-times text-red font-18"
                                              (click)="removeSelectedLicMasterDocument(index)"></i>
                                          </div>
                                        </label>
                                      </div>
                                    </div>

                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">Ok</button>
                            </div>
                          </ng-template>
                        </div>

                      </fieldset>
                    </div>
                  </div>
                  <br>
                  <div class=" col-md-8" *ngIf="devaiationData.length > 0">
                    <h3 class="font-14 text-purple font-bold ">Deviations</h3>
                    <div class="table-responsive Custom_Table">
                      <table class="table table-striped table-bordered table-hover m-b-0">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col">Deviation Types</th>
                            <th scope="col">User Input</th>
                            <th scope="col">Limit</th>
                            <th scope="col">Deviation Value</th>
                            <th scope="col">Reason</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let data of devaiationData;let index = index;">
                            <td>
                              <span *ngIf="data.deviationType == 'LoanAmount'"> Loan Amount</span>
                              <span *ngIf="data.deviationType == 'noOfInstallment'"> No. Of Installments</span>
                              <span *ngIf="data.deviationType == 'interestRate'"> Interest Rate</span>
                            </td>
                            <td>{{data.deviationValue | number:'1.2-2'}}</td>
                            <td>{{data.userLimit | number:'1.2-2'}}</td>
                            <td *ngIf="data.deviationType != 'interestRate'">{{data.deviationValue - data.userLimit |
                              number:'1.2-2'}}</td>
                            <td *ngIf="data.deviationType == 'interestRate'">{{data.userLimit - data.deviationValue |
                              number:'1.2-2'}}</td>
                            <td><input type="text" class="form-control" value="{{data.reason}}"
                                (focusout)="reasons($event.target.value, index)" [disabled]="viewFlag"
                                [ngClass]="{'is-invalid' : data.reason == undefined || data.reason == ''}"></td>
                            <!-- [ngClass]="{'is-invalid' : AddLoanForm.get('reason').status == 'INVALID'}" formControlName="reason" -->
                          </tr>

                        </tbody>
                      </table>
                    </div>
                  </div>
                  <br><br>
                  <div class="col-md-6" *ngIf="documentList.length > 0">
                    <h3 class="font-14 text-purple font-bold "> Upload Documents</h3>
                    <div class="table-responsive Custom_Table">

                      <table class="table table-striped table-bordered table-hover m-b-0">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col" class="wd-9">Sr .No.</th>
                            <th scope="col" class="wd-14">Document Name</th>
                            <th scope="col" class="wd-14">Attachment</th>
                            <th scope="col" class="wd-14">Remark</th>
                            <th scope="col" class="wd-14">Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let document of documentList ,let i = index;">
                            <td class="wd-9">{{i+1}}</td>
                            <td class="wd-14">{{document.documentName}}</td>

                            <td>
                              <i class="fa fa-paperclip text-orange"></i> &nbsp;
                              {{ document.fileName }}
                            </td>
                            <td class="wd-14">
                              <input type="text" class="form-control"
                                (focusout)="getDocumentReason($event.target.value)">
                            </td>

                            <td>
                              <i class="fa fa-upload font-16 text-blue cursor-pointer" tooltip="Upload"
                                (click)="UploadModalDocument(template1, i,document)" data-toggle="modal"
                                data-target="#UploadModal1"></i>&nbsp;&nbsp;
                            </td>

                          </tr>

                        </tbody>
                      </table>
                      <ng-template #template1>
                        <div class="modal-header">
                          <h5 class="modal-title" id="UploadModalLabel">Upload Document</h5>
                          <button type="button" (click)=" modalRef.hide(); " class="close" data-dismiss="modal"
                            aria-label="Close"><span aria-hidden="true">×</span></button>
                        </div>
                        <div class="modal-body">
                          <div class="card">
                            <div class="card-body">
                              <div class="row clearfix">

                                <div class="col-md-12">
                                  <div class="fileuploadbox bg-color-lightgray">
                                    <label class="filelabel">
                                      <i class="fa fa-upload">
                                      </i>
                                      <span class="title">
                                        Choose file
                                      </span>
                                      <input class="FileUpload1" class="dropify" (change)="onMasterUpload($event);"
                                        accept=".jpg , .jpeg, .pdf , .png" id="FileInput" type="file" multiple />
                                    </label>
                                  </div>
                                  <div *ngIf="masterfilesArray.length > 0 " class="fileuploadbox">
                                    Selected files
                                    <label *ngFor="let item of masterfilesArray;  let index = index;"
                                      class="filelabeldisplay">
                                      <div class="text-ellipsis"><i class="fa fa-paperclip">
                                        </i>
                                        <span class="title">
                                          {{ item.name }}
                                        </span>
                                      </div>
                                      <div>
                                        <i class="fa fa-times text-red font-18"
                                          (click)="removeSelectedLicMasterDocument(index)"></i>
                                      </div>
                                    </label>
                                  </div>
                                </div>

                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">Ok</button>
                        </div>
                      </ng-template>
                    </div>
                  </div>
                  

                  <div class="row ">
                    <div class="col-12">
                      <div class="card">
                        <div class="mb-0 row">
                          <div class="col-md-6">
                            <h3 class="font-14 text-purple font-bold">Approval Details</h3>

                          </div>
                          <div class="col-md-6 ">
                            <h6 class="font-12 mb-3 font-normal float-right">
                              <strong>Overall Status </strong>&nbsp;&nbsp;

                              <strong class="btn-bg-green p-2">Submit:Pending with Approver 2</strong>
                            </h6>
                          </div>

                        </div>
                        <div class="row">
                          <div class="col-md-12">
                            <div class="table-responsive Custom_Table">
                              <table class="table table-striped table-hover table-bordered m-b-0">
                                <thead class="thead-dark">
                                  <tr>
                                    <th scope="col" class="font700 ">Level</th>
                                    <th scope="col" class="font700 ">Approver code</th>
                                    <th scope="col" class="font700 ">Approver Name</th>
                                    <th scope="col" class="font700 ">Action Date & Time</th>
                                    <!-- <th scope="col" class="font700">Action Time</th> -->
                                    <th scope="col" class="font700 ">Status</th>
                                    <th scope="col" class="font700 ">Remark</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <td>1</td>
                                  <td>222</td>
                                  <td>AAA</td>
                                  <td>8-Jun-2021 &nbsp;  10.00 AM</td>
                                  <!-- <td>10.00 AM</td> -->
                                  <td>Pending</td>
                                  <td><input type="text" /></td>
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <br><br>

                  <ng-container class="float-right">
                    <!-- || (documentList.length != documentReason.length)

                    || (devaiationData.length != deviationReason.length) || (guarentedCount.length != guarantorName.length)-->
                    <!-- || (devaiationData.length != deviationReason.length)  || (guarentedCount.length != guarantorName.length) -->
                    <div class="row float-right" style="margin: 10px">
                      <button type="submit" class="custom_button custom_btn btn-bg-green btn-labeled btn-labeled-left" tooltip="Save"
                        >
                        <b> <i class="fa fa-check-square-o
                         
                          " aria-hidden="true"></i></b>Approve</button>&nbsp;

                      <button type="submit" tooltip="Update"
                        class="custom_button custom_btn btn-labeled btn-labeled-left" [disabled]="!AddLoanForm.valid"
                        (click)="updateLoan()"
                        [ngClass]="{'disabled-btn-bg-green' : AddLoanForm.invalid,'btn-bg-green': !AddLoanForm.invalid}"
                        *ngIf="isVisibleee">
                        <b> <i class="fa fa-floppy-o" aria-hidden="true"></i></b>Update</button>&nbsp;

                      <!-- <button type="submit" class="custom_button bg-btn-red custom_btn btn-labeled btn-labeled-left"
                      tooltip="Draft" ><b> <i class="fa fa-file" aria-hidden="true"></i></b>Draft</button
                      >&nbsp; -->

                      <button type="button" tooltip="Reset"
                        class="custom_button custom_btn bg-btn-red btn-labeled btn-labeled-left ml-10"
                        (click)="reset()" *ngIf="isVisible">
                        <b><i class="fa  fa-reply 
                          "></i></b>Send Back</button>&nbsp;

                      <!-- *ngIf="isVisiblee" -->
                      <button type="button" tooltip="Cancel"
                        class="custom_button custom_btn bg-teal-400 btn-labeled btn-labeled-left ml-10"
                        [routerLink]="['/loan/application']">
                        <b> <i class="fa fa-times-circle" aria-hidden="true"></i></b>Close</button>

                    </div>
                  </ng-container>
                </fieldset>
              </form>
            </div>
          </div>
        </div>
      </div>
      <app-footer></app-footer>
    </div>
  </div>
</div>