<app-leftmenu></app-leftmenu>

<div class="page">
  <app-header></app-header>
  <div class="section-body mt-3">
    <div class="container-fluid" style="border: 1px solid #ccc; background-color: #fff;">
      <div class="tabview-contents">
        <form class="card" role="form" [formGroup]="form" #formDirective="ngForm" method="post" novalidate>
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-body p-0">
                  <!-- <fieldset>
                    <legend>Job Master</legend> -->
                  <div class="row">

                    <div class="col-sm-3">
                      <label class="form-label">Job Master</label>
                      <select name="masterType" id="masterType" class="form-control" formControlName="masterType"
                        (change)='onSelectJobMaster($event.target.value)'>
                        <option *ngFor="let jobMaster of jobMasterList" [value]="jobMaster.value">
                          {{jobMaster.value}}
                        </option>
                      </select>
                    </div>



                    <div class="col-sm-3" *ngIf="hideFormControl">
                      <label class="form-label">Code</label>
                      <input type="text" formControlName="masterCode" class="form-control" name="code"
                        autocomplete="off" placeholder="Enter Code">
                    </div>

                    <div class="col-md-3" *ngIf="hideFormControl">
                      <label class="form-label">Description</label>
                      <textarea formControlName="masterDescription" class="form-control" rows="2" autocomplete="off"
                        placeholder="Enter Remark"></textarea>
                    </div>

                    <div class="col-md-3" *ngIf="hideFormControl"><br>
                      <label class="custom-control custom-checkbox custom-control-inline pl-45">
                        <input formControlName="isActive" type="checkbox" class="custom-control-input"
                          name="example-inline-checkbox1" value="option1" (change)="deactiveActiveCheckBox()" readonly>
                        <span class="custom-control-label">Active </span>
                      </label>
                    </div>
                  </div>

                  <div class="row pull-right mt-10">
                    <div class="col-sm-12 pull-right">
                      <div *ngIf="isEditMode ==false">

                        <button type="submit" [disabled]="form.invalid"
                          class="custom_button custom_btn btn-labeled btn-labeled-left" tooltip="Save"
                          (click)="saveMaster()"
                          [ngClass]="{'disabled-btn-bg-green' : form.invalid, 'btn-bg-green': !form.invalid}">
                          <b><i class="fa fa-floppy-o"></i></b> Save</button>

                        <button type="button" tooltip="Reset" (click)="cancelView()"
                          class="custom_button custom_btn bg-teal-400 btn-labeled btn-labeled-left ml-10">
                          <b><i class="fa  fa-refresh"></i></b> Reset</button>
                      </div>
                      <div *ngIf="isEditMode == true">

                        <button type="submit" [ngClass]="{'disabled-btn-bg-lightgrey' : form.invalid,
                              'btn-bg-green': !form.invalid}"
                          class="custom_button custom_btn btn-bg-green btn-labeled btn-labeled-left" tooltip="Update"
                          (click)="saveMaster()" [disabled]="form.invalid"><b><i class="fa fa-floppy-o"></i></b>
                          Update</button>

                        <button type="button"
                          class="mr-2 pull-right custom_button custom_btn bg-btn-red btn-labeled btn-labeled-left ml-10"
                          tooltip="Cancel" (click)="cancelView()"><b><i
                              class="fa fa-times-circle"></i></b>Cancel</button>
                      </div>
                    </div>
                  </div>
                  <!-- end of row -->
                  <!-- </fieldset> -->
                </div> <!-- card body -->
              </div>
            </div>
          </div>
        </form>
        <div class="row">
          <div class="col-md-6"></div>
          <div class="col-md-6" *ngIf="selectedCheckBox.length>0">
            <a class="pull-right text-link font-14" data-toggle="modal" data-target="#modal"
              (click)="UploadModal(template4)">ASSIGN TO COMPANY</a>
          </div>
        </div>

        <div class="tabset">
          <!-- Tab 1 -->
          <input type="radio" name="tabset" id="tab1" aria-controls="marzen" checked>
          <label for="tab1">Master Summary</label>
          <!-- Tab 2 -->
          <input type="radio" name="tabset" id="tab2" aria-controls="rauchbier" (click)="onClickAssignmentSummary()">
          <label for="tab2">Assignment Summary</label>
          <div class="tab-panels">
            <section id="marzen" class="tab-panel">
              <div class="row">
                <div class="col-12">
                  <div class="card">
                    <div class="row mb-0">

                      <div class="col-md-6">
                        <h3 class="font-14 text-purple font-bold">Summary</h3>
                      </div>

                    </div>
                    <div class="table-responsive Custom_Table">
                      <table class="table table-striped table-hover table-bordered m-b-0">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col" class="wd-10">Sr. No.</th>
                            <th scope="col" class="wd-15"> <input type="checkbox" [(ngModel)]="checks"
                                (click)="onCheckboxChange($event,-1)" />&nbsp;&nbsp;&nbsp;Select All

                            </th>
                            <th scope="col" class="wd-15">Master Type</th>
                            <th scope="col" class="wd-25">Code</th>
                            <th scope="col" class="wd-25">Description</th>
                            <th scope="col" class="wd-10">Actions</th>
                          </tr>
                        </thead>
                        <tbody>

                          <tr *ngFor="let summary of tableDataList; let i = index">
                            <td class="wd-10"><span tooltip="{{summary.SrNo}}">{{summary.SrNo}}</span>
                            </td>

                            <td *ngIf="summary.isActive"><input type="checkbox" [ngModel]="enableCheckAll" [value]="i"
                                [checked]="uncheckSelectAll ==true" (change)="onCheckboxChange($event,i)"
                                [disabled]="summary.isActive ==false"></td>

                            <td *ngIf="!summary.isActive"><input type="checkbox" [value]="i"
                                (change)="onCheckboxChange($event,i)" [disabled]="summary.isActive ==false"></td>

                            <td class="wd-10"><span tooltip="{{summary.masterType}}">{{summary.masterType}}</span>
                            </td>
                            <td class="wd-10"><span tooltip="{{summary.masterCode}}">{{summary.masterCode}}</span>
                            </td>
                            <td class="wd-10"><span
                                tooltip="{{summary.masterDescription}}">{{summary.masterDescription}}</span>
                            </td>
                            <td class="wd-10 align-left">
                              &nbsp;&nbsp;<span>
                                <i class="fa fa-edit font-16 text-dark-green cursor-pointer"
                                  (click)="editMaster(summary.masterId,summary.masterType)" tooltip="Edit"></i>
                              </span> &nbsp;
                              <span *ngIf="summary.isActive ==1">
                                <i class="fa fa-trash-o font-16 text-red cursor-pointer "
                                  (click)="ConfirmationDialog(confirmdialog, summary.masterId,summary.masterType,'master-summary')"></i>
                                <!-- (click)="DeleteMaster()" tooltip="Delete"></i> -->
                              </span>

                            </td>
                          </tr>
                          <tr *ngIf="!summaryHtmlDataList?.length">
                            <td colspan="10">
                              <span class="font-14 font500 align-center text-red">No Data Available</span>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

            </section>
            <section id="rauchbier" class="tab-panel">
              <div class="row">
                <div class="col-12">
                  <div class="card">
                    <div class="row mb-0">
                      <div class="col-md-6">
                        <h3 class="font-14 text-purple font-bold">Summary</h3>
                      </div>
                    </div>
                    <!-- <div class=""> -->
                    <div class="table-responsive Custom_Table">
                      <table class="table table-striped table-hover table-bordered m-b-0">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col" class="wd-10">Sr. No.</th>
                            <th scope="col" class="wd-25">Company Name</th>
                            <th scope="col" class="wd-25">Master Type</th>
                            <th scope="col" class="wd-25">Code</th>
                            <th scope="col" class="wd-15">Actions</th>
                          </tr>
                        </thead>
                        <tbody>

                          <tr *ngFor="let summary of summaryAllOtherMappingDetailsList; let i = index">
                            <!-- <td class="wd-10"><span tooltip="{{summary.SrNo}}">{{summary.SrNo}}</span>
                            </td> -->

                            <td class="wd-10"><span tooltip="{{summary.SrNo}}">{{summary.SrNo}}</span>
                            </td>
                            <td class="wd-30"><span tooltip="{{summary.companyName}}">{{summary.companyName}}</span>
                            </td>
                            <td class="wd-20"><span
                                tooltip="{{summary.masterMappingType}}">{{summary.masterMappingType}}</span>
                            </td>
                            <td class="wd-20"><span tooltip="{{summary.masterCode}}">{{summary.masterCode}}</span>
                            </td>
                            <td class="wd-20">
                              <span>
                                <!-- <i class="fa fa-eye font-16 text-blue cursor-pointer ml-3" (click)="viewMaster(i)"
                        tooltip="View"></i> &nbsp;&nbsp;&nbsp;&nbsp; -->
                                <i class="fa fa-trash-o font-16 text-red cursor-pointer"
                                  (click)="ConfirmationDialog(confirmdialog, summary.complianceHeadId)"
                                  tooltip="Delete"></i>
                              </span>
                              <!-- (click)="DeleteMasterMapping(summary.masterMappingId,summary.masterMappingType)" -->

                            </td>
                          </tr>
                          <tr *ngIf="!summaryAllOtherMappingDetailsList?.length">
                            <td colspan="10">
                              <span class="font-14 font500 align-center text-red">No Data Available</span>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
    <app-footer></app-footer>
  </div>
</div>




<ng-template #confirmdialog>
  <div class="modal-header">
    <h5 class="modal-title" id="UploadModalLabel">Confirmation Dialog</h5>
    <button type="button" (click)="modalRef.hide()" class="close" data-dismiss="modal" aria-label="Close"><span
        aria-hidden="true">×</span></button>
  </div>
  <div class="modal-body">
    <div class="card mb-0">
      <div class="card-body p-0 m-0">
        <div class="row clearfix">
          <div class="col-md-12">
            <i class="fa fa-question-circle font-18 font700" aria-hidden="true"></i> &nbsp; &nbsp; <label
              class="font-14 mb-0 font700">Are You Sure do you want to delete Record.</label>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn bg-color-green" (click)="modalRef.hide()" (click)="clickedOnYes()"> <i
        class="fa fa-check" aria-hidden="true"></i> &nbsp; Yes</button>
    <button type="button" class="btn bg-btn-red" (click)="modalRef.hide()"> <i class="fa fa-times"
        aria-hidden="true"></i> &nbsp; No</button>
  </div>
</ng-template>




<ng-template #template4>
  <div class="modal-header">
    <h5 class="modal-title" id="UploadModalLabel">Assign To Company</h5>
    <button type="button" (click)="modalRef.hide()" class="close" data-dismiss="modal" aria-label="Close"><span
        aria-hidden="true">X</span></button>
  </div>
  <div class="modal-body ">
    <div class="card mb-0  ">
      <div class="card-body box-line-border">
        <div class="clearfix">
          <div class="row" style="font-size: smaller">
            <div class="col-sm-12">
              <!-- <div class="row"> -->
              <!-- <div class="col-12"> -->
              <div class="card mb-0">
                <div class="mb-0">
                  <h3 class="font-14 text-purple font-bold"> Company</h3>
                </div>
                <!-- <div class=""> -->
                <div class="table-responsive Custom_Table mb-0">
                  <table class="table table-striped table-hover table-bordered mb-0">
                    <thead class="thead-dark">
                      <tr>
                        <th scope="col" class="wd-50"> <input type="checkbox" [(ngModel)]="checksCompany" [value]="-1"
                            (change)="onCheckCompanyboxChange($event,-1)">&nbsp;&nbsp;&nbsp;Select
                          All</th>
                        <th scope="col" class="wd-50">Company Name</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let summary of summaryCompanyHtmlDataList; let i = index">
                        <td class="wd-50"><input type="checkbox" [(ngModel)]="enableCompanyCheckAll" value
                            (change)="onCheckCompanyboxChange($event,i)"></td>
                        <td class="wd-50"><span tooltip="{{summary.companyName}}">{{summary.companyName}}</span>
                        </td>
                      </tr>
                      <tr *ngIf="summaryCompanyHtmlDataList.length ==0">
                        <td colspan="2">
                          <span class="font-14 font500 align-center text-red">No Data Available</span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" [disabled]="form.invalid"
                  class="custom_button custom_btn btn-labeled btn-labeled-left pull-right" tooltip="Save"
                  (click)="saveMapToCompany()"
                  [ngClass]="{'disabled-btn-bg-green' : form.invalid, 'btn-bg-green': !form.invalid}">
                  <b><i class="fa fa-floppy-o"></i></b> Save</button>
              </div>
              <!-- </div> -->
              <!-- </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
